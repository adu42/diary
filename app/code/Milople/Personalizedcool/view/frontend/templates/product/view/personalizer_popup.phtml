<?php
/**
*
* Do not edit or add to this file if you wish to upgrade the module to newer
* versions in the future. If you wish to customize the module for your
* needs please contact us to https://www.milople.com/contact-us.html
*
* @category    Ecommerce
* @package     Milople_Personlized
* @copyright   Copyright (c) 2017 Milople Technologies Pvt. Ltd. All Rights Reserved.
* @url         https://www.milople.com/magento2-extensions/personalized-products-m2.html
*
**/
?>
<?php
  $imageHelper = $this->helper('Magento\Catalog\Helper\Image');
  $helper = $this->personalized_helper;
  $p_id = $this->getRequest()->getParam('id');
	$product = $block->getProductById($p_id);
  $status = $helper->getConfig('personalizedcool/license_status_group/status');
	$enableFromProduct = $product->getAllowPersonalization();	
  $productType=$product->getTypeId();
  if(($status && $enableFromProduct) || ($product->getTypeId()=='personalized' && $status)): 
  $isGoogleFontEnable = $helper->getConfig('personalizedcool/text_setting_group/google_font_enabled');
  $pricePerText = $helper->getConfig('personalizedcool/text_setting_group/price_per_text');
  $pricePerImage = $helper->getConfig('personalizedcool/Image_setting_group/personalized_price_per_image');
  $isProductHasSide = $helper->isProductHasSide($product);
  $googleFontList = '';
  if ($isGoogleFontEnable) {
    $googleFontList = $helper->getConfig('personalizedcool/text_setting_group/google_fonts');
    $googleFontListCss = str_replace(',', '|', $googleFontList);
  }
 	$fonts = $this->getFontCollection();
  $tab1 = $helper->getConfig('personalizedcool/text_setting_group/text_enabled');
  $tab2 = $helper->getConfig('personalizedcool/Image_setting_group/image_enabled');
  $tab3 = $helper->getConfig('personalizedcool/Image_setting_group/clipart_enabled');
  $thumbWidth = '50px';
  $thumbHeight = '50px';
  $imageFitCanvas = $helper->getConfig('personalizedcool/Image_setting_group/image_fit');
  $isRaw = $helper->getConfig('personalizedcool/Image_setting_group/is_raw');
 
   $sideCount = $helper->getSideCount($product);
  $textObject = 0;
  $imageObject = 0;
  $width = $helper->getConfig('personalizedcool/area_setting_group/width');
  $height = $helper->getConfig('personalizedcool/area_setting_group/height');
  $flag = "not allowed";
  $flagForHide = "hide";
  $isRestrictedAreaDrawn=$helper->isRestrictedAreaDrawn($product);
  $isGlobalRestrictedAllowed=$helper->getConfig('personalizedcool/general_setting_group/enable_area');
  $pricePerText = $helper->getConfig('personalizedcool/text_setting_group/price_per_text');
?>
<style type="text/css">
 
        <?php foreach($fonts as $font): ?>
            @font-face {
                font-family:"<?php echo $font->getName() ?>";
                src: url("<?php echo $this->getFontFolder().$font->getTtfname() ?>"),
                   url("<?php echo $this->getFontFolder().$font->getWoffname() ?>");
            }
            select#font_selection option[value="<?php echo $font->getName() ?>"] {
              font-family: "<?php echo $font->getName() ?>";
              font-size: 15px;
            }
        <?php endforeach; ?>
</style>
<div class="personalizer_popup">
	<div class="personalized-container popup-personalized">
		<button type="submit" class="circle" style='display:none;' value=""></button>
		<div class="small_border_label">

			<?php if($tab1): ?>
				<input id="tab1" type="radio" class="personalized_tab_radio" name="tabs"
				<?php if($tab1): ?>checked <?php endif; ?> >
				<label id="tab-text" for="tab1" data-section='content-text' data-border='#41b5df' class="icon label_in_popup" data-icon="q"><?php echo __('ADD TEXT') ?>
				</label>
				<section id="content-text">
							<div class="text_content">

								<input type="text" data-price-per-text="<?php echo $pricePerText; ?>" id="add_text" class="addTextPersonalized input-text" placeholder="<?php echo __('Enter text here') ?>" maxlength="14" >
							<input type="button"  id="add_text_button" value="<?php echo __('Add Text')?>" class="action primary " onClick="addtext()" />
								<input type="button" value="<?php echo __('Update Text') ?>" class="action primary  update-text" onClick="updatetext()" style="display: none;" />
								<button id="format_text" style='display:none;' onclick='formatText()' type="button" class="action primary" disabled>
									<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/format-text.png') ?>" />
								</button>
								<br/><span style="font-size:10px;color:red;">Max 14 Characters are allowed</span>
						 	</div><!--Text Content -->
							<div class="text_style">
							<div class="text_effect_buttons">
									<button type="button" id="text-bold" title="<?php echo __('Bold'); ?>" class="font-size" >
									<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/bold.png') ?>" />
									</button>
									<button type="button" id="text-italic" title="<?php echo __('Italic'); ?>" class="font-size" >
										<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/italic.png') ?>" />
									</button>
									<button type="button" id="text-underline" title="<?php echo __('Underline'); ?>" class="font-size"  >
										<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/underline.png') ?>" />
								 </button>
									<button type="button" title="<?php echo __('Increase Font Size'); ?>" id="font_inc" class="font-size">
										<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/increase.png') ?>" />
									</button>
									<button type="button" id="font_dec" title="<?php echo __('Decrease Font Size'); ?>"  class="font-size">
										<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/decrease.png') ?>" />
								 </button>
								<button type="button" id="font_style_effect" style="display:none;" title="<?php echo __('Font Style & Effect'); ?>"  class="font-size">
										<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/font.png') ?>" />
								</button>
								<button type="button" title="<?php echo __('Font Color'); ?>" class="font_color" name="font_color"></button>
								<div class="color-picker"></div>
								<button type="button" title="<?php echo __('Background Color'); ?>" class="background_color" name="background_color"></button>
								<div class="backgroundcolor-picker"></div>
								<button type="button" id="text-left" class="align" title="<?php echo __('Align Left'); ?>" >
										 <img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/left-align.png') ?>" />
									</button>
									<button type="button" id="text-center" title="<?php echo __('Align Center'); ?>" class="align" >
										<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/center-align.png') ?>" />
									</button>
									<button type="button" id="text-right" title="<?php echo __('Align Right'); ?>" class="align">
										<img src="<?php echo $this->getViewFileUrl('Milople_Personalizedcool::images/right-align.png') ?>" />
									</button>
							</div>
							<div class="font_style_popup">
								<select id="font_selection" title="<?php echo __('Font Type'); ?>" >
									 <?php foreach($fonts as $font): ?>
											<option class="font_option" value="<?php echo $font->getName(); ?>"><?php echo $font->getName(); ?></option>
									 <?php endforeach; ?>
										<?php foreach(explode(',',$googleFontList)  as $googleFont): ?>
											<option class="font_option" value="<?php echo $googleFont; ?>"><?php echo str_replace('+',' ',$googleFont); ?></option>
										<?php endforeach; ?>
								</select>
								<h4 id="text_effects_title" ><?php echo __('Text Effects'); ?></h4>
								<div class="text_effects" style="display:block;">
									<ul class="distance_between_list">
										<li class="field effect_field"><?php echo __('Effect'); ?>:</li>
										<li class="data">
											<select name="effect" id="effect" >
												<option value="STRAIGHT"><?php echo __('Normal'); ?></option>
												<option value="curved"><?php echo __('Curved'); ?></option>
												<option value="arc"><?php echo __('Arc'); ?></option>
												<option value="smallToLarge"><?php echo __('Small to Large'); ?></option>
												<option value="largeToSmallTop"><?php echo __('Large to Small Toped'); ?></option>
												<option value="largeToSmallBottom"><?php echo __('Large to Small Bottom'); ?></option>
												<option value="bulge"><?php echo __('Bulge'); ?></option>
											</select>
										</li>
										<li class="field radius-effect"><?php echo __('Radius'); ?>:</li>
										<li class="data radius-effect"><input type="range"  min="0" max="100" value="50" id="radius" /></li>
										<li class="field spacing-effect"><?php echo __('Spacing'); ?>:</li>
										<li class="data spacing-effect"><input type="range"  min="5" max="40" value="20" id="spacing" /></li>
										<li class="field reverse-effect"><?php echo __('Reverse'); ?>:</li>
										<li class="data reverse-effect"><input type="checkbox" name="reverse" id="reverse" /></li>
									</ul>
								</div> <!-- Text Effect -->
							</div>
						 </div><!--Text Style End -->
							<div class="directional-pad" id="edit-element">
									<div class='popup-controls'>
									<button onclick="moveTop()" id="top" title="Move Top" type="button"><span data-icon="E"></span></button>
									<button onclick="moveTopLeft()" id="top-left" title="Move Top Left" type="button"><span data-icon="D"></span></button>
									<button onclick="moveTopRight()" id="top-right" title="Move Top Right" type="button"><span data-icon="F"></span></button>
									<button onclick="moveCenter()" id="center" title="Move Center" type="button"><span data-icon="L"></span></button>
									<button onclick="moveBottom()" id="bottom" title="Move Bottom" type="button"><span data-icon="I"></span></button>
									<button onclick="moveBottomLeft()" id="bottom-left" title="Move Bottom Left" type="button"><span data-icon="J"></span></button>
									<button onclick="moveBottomRight()" id="bottom-right" title="Move Bottom Right" type="button"><span data-icon="H"></span></button>
									<button onclick="moveLeft()" id="left" title="Move Left" type="button"><span data-icon="K"></span></button>
									<button onclick="moveRight()" id="right" title="Move Right" type="button"><span data-icon="G"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="rotateClock()" id="rotate" title="Rotate" type="button">&#8635;</button>
									<button type="button" title="Anti Rotate" id="antirotate" onclick="rotateAntiClock()">&#8634;</button>
									</div>
									<div class='popup-controls'>
									<button onclick="bringToFront()" id="btf" title="Bring to Front" type="button"><span data-icon="C"></span></button>
									<button onclick="sendToBack()" id="stb" title="Send to Back" type="button"><span data-icon="A"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="flipHorizontal()" id="fh" title="Flip Horizontal" type="button"><span data-icon="t"></span></button>
									<button onclick="flipVertical()" id="fv" title="Flip Vertical" type="button"><span data-icon="B"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="cloneObject()" id="clone" title="Duplicate" type="button"><span data-icon="y"></span></button>
									<button onclick="deleteObject()" id="delete" title="Delete" type="button"><span data-icon="w"></span></button>
									</div>
								<div class='popup-controls'>
									<button id="undo" title="Undo" type="button" disabled>&#8617;</button>
									<button id="redo" title="Redo" type="button" disabled>&#8618;</button>
									</div>
						</div>
			</section>
			<?php endif; ?>
			<?php if($tab2): ?>
				<input  id="tab2"  type="radio" class="personalized_tab_radio" name="tabs" <?php if(!$tab1): ?>checked <?php endif;?> >
				<label id="tab-image" data-section='content-upload' data-border='#39a853' class="icon label_in_popup" data-icon="d" for="tab2"><?php echo __('UPLOAD IMAGE') ?>
				</label>
				<section id="content-upload">
					<input type="file" id="uploadimage" name="uploadimage" data-price-per-image="<?php echo $pricePerImage ?>" />
						<div class="directional-pad" id="edit-element">
									<div class='popup-controls'>
									<button onclick="moveTop()" id="top" title="Move Top" type="button"><span data-icon="E"></span></button>
									<button onclick="moveTopLeft()" id="top-left" title="Move Top Left" type="button"><span data-icon="D"></span></button>
									<button onclick="moveTopRight()" id="top-right" title="Move Top Right" type="button"><span data-icon="F"></span></button>
									<button onclick="moveCenter()" id="center" title="Move Center" type="button"><span data-icon="L"></span></button>
									<button onclick="moveBottom()" id="bottom" title="Move Bottom" type="button"><span data-icon="I"></span></button>
									<button onclick="moveBottomLeft()" id="bottom-left" title="Move Bottom Left" type="button"><span data-icon="J"></span></button>
									<button onclick="moveBottomRight()" id="bottom-right" title="Move Bottom Right" type="button"><span data-icon="H"></span></button>
									<button onclick="moveLeft()" id="left" title="Move Left" type="button"><span data-icon="K"></span></button>
									<button onclick="moveRight()" id="right" title="Move Right" type="button"><span data-icon="G"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="rotateClock()" id="rotate" title="Rotate" type="button">&#8635;</button>
									<button type="button" title="Anti Rotate" id="antirotate" onclick="rotateAntiClock()">&#8634;</button>
									</div>
									<div class='popup-controls'>
									<button onclick="bringToFront()" id="btf" title="Bring to Front" type="button"><span data-icon="C"></span></button>
									<button onclick="sendToBack()" id="stb" title="Send to Back" type="button"><span data-icon="A"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="flipHorizontal()" id="fh" title="Flip Horizontal" type="button"><span data-icon="t"></span></button>
									<button onclick="flipVertical()" id="fv" title="Flip Vertical" type="button"><span data-icon="B"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="cloneObject()" id="clone" title="Duplicate" type="button"><span data-icon="y"></span></button>
									<button onclick="deleteObject()" id="delete" title="Delete" type="button"><span data-icon="w"></span></button>
									</div>
							<div class='popup-controls'>
									<button id="undoImage" title="Undo" type="button" disabled>&#8617;</button>
									<button id="redoImage" title="Redo" type="button" disabled>&#8618;</button>
									</div>
						</div>
				</section>
			<?php endif; ?>
			<?php if($tab3): ?>
				<input id="tab3" type="radio" class="personalized_tab_radio" name="tabs" <?php if(!$tab2): ?>checked <?php endif;?> >
				<label id="tab-clip" data-section='content-clipart' data-border='#f28035' class="icon label_in_popup" data-icon="b" for="tab3"><?php echo __('CLIP ART') ?>
				</label>
				<section id="content-clipart">
						<div id="clipart_categories_container">
								<select id="clipart_categories" name="clipart_category_id">
									<option value=""><?php echo __('Select Clip Art Category'); ?></option>
										<?php foreach($helper->getCategory() as $category): ?>
											<?php  $root_cat_id =$category->getId(); ?>
											<option value="<?php echo $root_cat_id; ?>"><?php echo $category->getName(); ?></option>
											 <?php endforeach; ?>
								 </select>
						</div>
						<div id="clipart_images_container" class="a-center">
							<div id="image_list" class="image_list">
											<?php foreach($helper->getAllImages() as $image): ?>
												 <?php if($helper->checkCategoryImageStatus($image->getId())) :?>

												 <img style="width:<?php echo  $thumbWidth ?>;height:<?php echo  $thumbHeight ?>;" src="<?php echo $helper->getMediaPath().$image->getPath() ?>" class="clipart-image" alt="<?php echo $image->getName() ?>" title="<?php echo $image->getName() ?>"/>
													<?php endif; ?>
												 <?php endforeach; ?>
										</div>
										<span class="a-center" id="clipart-images-loader" style="display:none;">
											 <img src="<?php echo $block->getViewFileUrl('Milople_Personalizedcool::images/ajax-loader.gif') ?>" class="v-middle" alt=""/>
										</span>
										<?php if(count($helper->getAllImages()) == 0): ?>
											<span class="a-center"> <?php  echo __("Sorry, no images found."); ?></span>
										<?php endif; ?>
						</div>
						<div class="directional-pad" id="edit-element">
									<div class='popup-controls'>
									<button onclick="moveTop()" id="top" title="Move Top" type="button"><span data-icon="E"></span></button>
									<button onclick="moveTopLeft()" id="top-left" title="Move Top Left" type="button"><span data-icon="D"></span></button>
									<button onclick="moveTopRight()" id="top-right" title="Move Top Right" type="button"><span data-icon="F"></span></button>
									<button onclick="moveCenter()" id="center" title="Move Center" type="button"><span data-icon="L"></span></button>
									<button onclick="moveBottom()" id="bottom" title="Move Bottom" type="button"><span data-icon="I"></span></button>
									<button onclick="moveBottomLeft()" id="bottom-left" title="Move Bottom Left" type="button"><span data-icon="J"></span></button>
									<button onclick="moveBottomRight()" id="bottom-right" title="Move Bottom Right" type="button"><span data-icon="H"></span></button>
									<button onclick="moveLeft()" id="left" title="Move Left" type="button"><span data-icon="K"></span></button>
									<button onclick="moveRight()" id="right" title="Move Right" type="button"><span data-icon="G"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="rotateClock()" id="rotate" title="Rotate" type="button">&#8635;</button>
									<button type="button" title="Anti Rotate" id="antirotate" onclick="rotateAntiClock()">&#8634;</button>
									</div>
									<div class='popup-controls'>
									<button onclick="bringToFront()" id="btf" title="Bring to Front" type="button"><span data-icon="C"></span></button>
									<button onclick="sendToBack()" id="stb" title="Send to Back" type="button"><span data-icon="A"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="flipHorizontal()" id="fh" title="Flip Horizontal" type="button"><span data-icon="t"></span></button>
									<button onclick="flipVertical()" id="fv" title="Flip Vertical" type="button"><span data-icon="B"></span></button>
									</div>
									<div class='popup-controls'>
									<button onclick="cloneObject()" id="clone" title="Duplicate" type="button"><span data-icon="y"></span></button>
									<button onclick="deleteObject()" id="delete" title="Delete" type="button"><span data-icon="w"></span></button>
									</div>
								<div class='popup-controls'>
									<button id="undoClipart" title="Undo" type="button" disabled>&#8617;</button>
									<button id="redoClipart" title="Redo" type="button" disabled>&#8618;</button>
									</div>
						</div>
				</section>
			 <?php endif; ?>
		</div>
	</div>
	<!--Direction pad & format text on selected object-->
	<div class="on-selected-object">
			<div class="small-directional-pad" id="small-edit-element" style="display:none;">
			<button onclick="bringToFront()" id="btf" title="Bring to Front" type="button" style="display:block;"><span data-icon="C"></span></button>
			<button onclick="sendToBack()" id="stb" title="Send to Back" type="button" style="display:block;"><span data-icon="A"></button>
			<button onclick="flipHorizontal()" id="fh" title="Flip Horizontal" type="button" style="display:block;"><span data-icon="t"></span></button>
			<button onclick="flipVertical()" id="fv" title="Flip Vertical" type="button" style="display:block;"><span data-icon="B"></button>
		</div>
	</div>
	<div class="done-button done-button-black wide-screen">Done !</div><br/><br/>
	 <div style="color: red;"><span id="charge">Rs. <?php echo $pricePerText; ?></span> will be charged extra for personalization</div>
</div>
<?php endif;  ?>
<script>
	require(['jquery'], function(jQuery) {
	  formatText = function (){
         jQuery(".text_content").css({
            "display": "none"
        });
        jQuery(".text_effect_buttons").css({
            "display": "block"
        });
    }
   });
</script>
